<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>URL.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">dubbo-remoting-zookeeper</a> &gt; <a href="../index.html" class="el_bundle">dubbo-common</a> &gt; <a href="index.source.html" class="el_package">org.apache.dubbo.common</a> &gt; <span class="el_source">URL.java</span></div><h1>URL.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.dubbo.common;

import org.apache.dubbo.common.utils.CollectionUtils;
import org.apache.dubbo.common.utils.NetUtils;
import org.apache.dubbo.common.utils.StringUtils;

import java.io.Serializable;
import java.io.UnsupportedEncodingException;
import java.net.InetSocketAddress;
import java.net.MalformedURLException;
import java.net.URLDecoder;
import java.net.URLEncoder;
import java.util.*;
import java.util.concurrent.ConcurrentHashMap;

/**
 * URL - Uniform Resource Locator (Immutable, ThreadSafe)
 * &lt;p&gt;
 * url example:
 * &lt;ul&gt;
 * &lt;li&gt;http://www.facebook.com/friends?param1=value1&amp;amp;param2=value2
 * &lt;li&gt;http://username:password@10.20.130.230:8080/list?version=1.0.0
 * &lt;li&gt;ftp://username:password@192.168.1.7:21/1/read.txt
 * &lt;li&gt;registry://192.168.1.7:9090/org.apache.dubbo.service1?param1=value1&amp;amp;param2=value2
 * &lt;/ul&gt;
 * &lt;p&gt;
 * Some strange example below:
 * &lt;ul&gt;
 * &lt;li&gt;192.168.1.3:20880&lt;br&gt;
 * for this case, url protocol = null, url host = 192.168.1.3, port = 20880, url path = null
 * &lt;li&gt;file:///home/user1/router.js?type=script&lt;br&gt;
 * for this case, url protocol = file, url host = null, url path = home/user1/router.js
 * &lt;li&gt;file://home/user1/router.js?type=script&lt;br&gt;
 * for this case, url protocol = file, url host = home, url path = user1/router.js
 * &lt;li&gt;file:///D:/1/router.js?type=script&lt;br&gt;
 * for this case, url protocol = file, url host = null, url path = D:/1/router.js
 * &lt;li&gt;file:/D:/1/router.js?type=script&lt;br&gt;
 * same as above file:///D:/1/router.js?type=script
 * &lt;li&gt;/home/user1/router.js?type=script &lt;br&gt;
 * for this case, url protocol = null, url host = null, url path = home/user1/router.js
 * &lt;li&gt;home/user1/router.js?type=script &lt;br&gt;
 * for this case, url protocol = null, url host = home, url path = user1/router.js
 * &lt;/ul&gt;
 *
 * @see java.net.URL
 * @see java.net.URI
 */
public /**final**/ class URL implements Serializable {

    private static final long serialVersionUID = -1985165475234910535L;

    private final String protocol;

    private final String username;

    private final String password;

    // by default, host to registry
    private final String host;

    // by default, port to registry
    private final int port;

    private final String path;

    private final Map&lt;String, String&gt; parameters;

    // ==== cache ====

    private volatile transient Map&lt;String, Number&gt; numbers;

    private volatile transient Map&lt;String, URL&gt; urls;

    private volatile transient String ip;

    private volatile transient String full;

    private volatile transient String identity;

    private volatile transient String parameter;

    private volatile transient String string;

<span class="nc" id="L100">    protected URL() {</span>
<span class="nc" id="L101">        this.protocol = null;</span>
<span class="nc" id="L102">        this.username = null;</span>
<span class="nc" id="L103">        this.password = null;</span>
<span class="nc" id="L104">        this.host = null;</span>
<span class="nc" id="L105">        this.port = 0;</span>
<span class="nc" id="L106">        this.path = null;</span>
<span class="nc" id="L107">        this.parameters = null;</span>
<span class="nc" id="L108">    }</span>

    public URL(String protocol, String host, int port) {
<span class="nc" id="L111">        this(protocol, null, null, host, port, null, (Map&lt;String, String&gt;) null);</span>
<span class="nc" id="L112">    }</span>

    public URL(String protocol, String host, int port, String[] pairs) { // varargs ... conflict with the following path argument, use array instead.
<span class="nc" id="L115">        this(protocol, null, null, host, port, null, CollectionUtils.toStringMap(pairs));</span>
<span class="nc" id="L116">    }</span>

    public URL(String protocol, String host, int port, Map&lt;String, String&gt; parameters) {
<span class="nc" id="L119">        this(protocol, null, null, host, port, null, parameters);</span>
<span class="nc" id="L120">    }</span>

    public URL(String protocol, String host, int port, String path) {
<span class="nc" id="L123">        this(protocol, null, null, host, port, path, (Map&lt;String, String&gt;) null);</span>
<span class="nc" id="L124">    }</span>

    public URL(String protocol, String host, int port, String path, String... pairs) {
<span class="nc" id="L127">        this(protocol, null, null, host, port, path, CollectionUtils.toStringMap(pairs));</span>
<span class="nc" id="L128">    }</span>

    public URL(String protocol, String host, int port, String path, Map&lt;String, String&gt; parameters) {
<span class="nc" id="L131">        this(protocol, null, null, host, port, path, parameters);</span>
<span class="nc" id="L132">    }</span>

    public URL(String protocol, String username, String password, String host, int port, String path) {
<span class="nc" id="L135">        this(protocol, username, password, host, port, path, (Map&lt;String, String&gt;) null);</span>
<span class="nc" id="L136">    }</span>

    public URL(String protocol, String username, String password, String host, int port, String path, String... pairs) {
<span class="nc" id="L139">        this(protocol, username, password, host, port, path, CollectionUtils.toStringMap(pairs));</span>
<span class="nc" id="L140">    }</span>

<span class="nc" id="L142">    public URL(String protocol, String username, String password, String host, int port, String path, Map&lt;String, String&gt; parameters) {</span>
<span class="nc bnc" id="L143" title="All 6 branches missed.">        if ((username == null || username.length() == 0)</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                &amp;&amp; password != null &amp;&amp; password.length() &gt; 0) {</span>
<span class="nc" id="L145">            throw new IllegalArgumentException(&quot;Invalid url, password without username!&quot;);</span>
        }
<span class="nc" id="L147">        this.protocol = protocol;</span>
<span class="nc" id="L148">        this.username = username;</span>
<span class="nc" id="L149">        this.password = password;</span>
<span class="nc" id="L150">        this.host = host;</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">        this.port = (port &lt; 0 ? 0 : port);</span>
        // trim the beginning &quot;/&quot;
<span class="nc bnc" id="L153" title="All 4 branches missed.">        while (path != null &amp;&amp; path.startsWith(&quot;/&quot;)) {</span>
<span class="nc" id="L154">            path = path.substring(1);</span>
        }
<span class="nc" id="L156">        this.path = path;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        if (parameters == null) {</span>
<span class="nc" id="L158">            parameters = new HashMap&lt;String, String&gt;();</span>
        } else {
<span class="nc" id="L160">            parameters = new HashMap&lt;String, String&gt;(parameters);</span>
        }
<span class="nc" id="L162">        this.parameters = Collections.unmodifiableMap(parameters);</span>
<span class="nc" id="L163">    }</span>

    /**
     * Parse url string
     *
     * @param url URL string
     * @return URL instance
     * @see URL
     */
    public static URL valueOf(String url) {
<span class="nc bnc" id="L173" title="All 4 branches missed.">        if (url == null || (url = url.trim()).length() == 0) {</span>
<span class="nc" id="L174">            throw new IllegalArgumentException(&quot;url == null&quot;);</span>
        }
<span class="nc" id="L176">        String protocol = null;</span>
<span class="nc" id="L177">        String username = null;</span>
<span class="nc" id="L178">        String password = null;</span>
<span class="nc" id="L179">        String host = null;</span>
<span class="nc" id="L180">        int port = 0;</span>
<span class="nc" id="L181">        String path = null;</span>
<span class="nc" id="L182">        Map&lt;String, String&gt; parameters = null;</span>
<span class="nc" id="L183">        int i = url.indexOf(&quot;?&quot;); // seperator between body and parameters </span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (i &gt;= 0) {</span>
<span class="nc" id="L185">            String[] parts = url.substring(i + 1).split(&quot;\\&amp;&quot;);</span>
<span class="nc" id="L186">            parameters = new HashMap&lt;String, String&gt;();</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">            for (String part : parts) {</span>
<span class="nc" id="L188">                part = part.trim();</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">                if (part.length() &gt; 0) {</span>
<span class="nc" id="L190">                    int j = part.indexOf('=');</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                    if (j &gt;= 0) {</span>
<span class="nc" id="L192">                        parameters.put(part.substring(0, j), part.substring(j + 1));</span>
                    } else {
<span class="nc" id="L194">                        parameters.put(part, part);</span>
                    }
                }
            }
<span class="nc" id="L198">            url = url.substring(0, i);</span>
        }
<span class="nc" id="L200">        i = url.indexOf(&quot;://&quot;);</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (i &gt;= 0) {</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">            if (i == 0) {</span>
<span class="nc" id="L203">                throw new IllegalStateException(&quot;url missing protocol: \&quot;&quot; + url + &quot;\&quot;&quot;);</span>
            }
<span class="nc" id="L205">            protocol = url.substring(0, i);</span>
<span class="nc" id="L206">            url = url.substring(i + 3);</span>
        } else {
            // case: file:/path/to/file.txt
<span class="nc" id="L209">            i = url.indexOf(&quot;:/&quot;);</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">            if (i &gt;= 0) {</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">                if (i == 0) {</span>
<span class="nc" id="L212">                    throw new IllegalStateException(&quot;url missing protocol: \&quot;&quot; + url + &quot;\&quot;&quot;);</span>
                }
<span class="nc" id="L214">                protocol = url.substring(0, i);</span>
<span class="nc" id="L215">                url = url.substring(i + 1);</span>
            }
        }

<span class="nc" id="L219">        i = url.indexOf(&quot;/&quot;);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (i &gt;= 0) {</span>
<span class="nc" id="L221">            path = url.substring(i + 1);</span>
<span class="nc" id="L222">            url = url.substring(0, i);</span>
        }
<span class="nc" id="L224">        i = url.lastIndexOf(&quot;@&quot;);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (i &gt;= 0) {</span>
<span class="nc" id="L226">            username = url.substring(0, i);</span>
<span class="nc" id="L227">            int j = username.indexOf(&quot;:&quot;);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (j &gt;= 0) {</span>
<span class="nc" id="L229">                password = username.substring(j + 1);</span>
<span class="nc" id="L230">                username = username.substring(0, j);</span>
            }
<span class="nc" id="L232">            url = url.substring(i + 1);</span>
        }
<span class="nc" id="L234">        i = url.lastIndexOf(&quot;:&quot;);</span>
<span class="nc bnc" id="L235" title="All 4 branches missed.">        if (i &gt;= 0 &amp;&amp; i &lt; url.length() - 1) {</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if (url.lastIndexOf(&quot;%&quot;) &gt; i) {</span>
                // ipv6 address with scope id
                // e.g. fe80:0:0:0:894:aeec:f37d:23e1%en0
                // see https://howdoesinternetwork.com/2013/ipv6-zone-id
                // ignore
            } else {
<span class="nc" id="L242">                port = Integer.parseInt(url.substring(i+1));</span>
<span class="nc" id="L243">                url = url.substring(0, i);</span>
            }
        }
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (url.length() &gt; 0) {</span>
<span class="nc" id="L247">            host = url;</span>
        }
<span class="nc" id="L249">        return new URL(protocol, username, password, host, port, path, parameters);</span>
    }

    public static String encode(String value) {
<span class="nc bnc" id="L253" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L254">            return &quot;&quot;;</span>
        }
        try {
<span class="nc" id="L257">            return URLEncoder.encode(value, &quot;UTF-8&quot;);</span>
<span class="nc" id="L258">        } catch (UnsupportedEncodingException e) {</span>
<span class="nc" id="L259">            throw new RuntimeException(e.getMessage(), e);</span>
        }
    }

    public static String decode(String value) {
<span class="nc bnc" id="L264" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L265">            return &quot;&quot;;</span>
        }
        try {
<span class="nc" id="L268">            return URLDecoder.decode(value, &quot;UTF-8&quot;);</span>
<span class="nc" id="L269">        } catch (UnsupportedEncodingException e) {</span>
<span class="nc" id="L270">            throw new RuntimeException(e.getMessage(), e);</span>
        }
    }

    public String getProtocol() {
<span class="nc" id="L275">        return protocol;</span>
    }

    public URL setProtocol(String protocol) {
<span class="nc" id="L279">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    public String getUsername() {
<span class="nc" id="L283">        return username;</span>
    }

    public URL setUsername(String username) {
<span class="nc" id="L287">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    public String getPassword() {
<span class="nc" id="L291">        return password;</span>
    }

    public URL setPassword(String password) {
<span class="nc" id="L295">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    public String getAuthority() {
<span class="nc bnc" id="L299" title="All 6 branches missed.">        if ((username == null || username.length() == 0)</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                &amp;&amp; (password == null || password.length() == 0)) {</span>
<span class="nc" id="L301">            return null;</span>
        }
<span class="nc bnc" id="L303" title="All 2 branches missed.">        return (username == null ? &quot;&quot; : username)</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">                + &quot;:&quot; + (password == null ? &quot;&quot; : password);</span>
    }

    public String getHost() {
<span class="nc" id="L308">        return host;</span>
    }

    public URL setHost(String host) {
<span class="nc" id="L312">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    /**
     * Fetch IP address for this URL.
     *
     * Pls. note that IP should be used instead of Host when to compare with socket's address or to search in a map
     * which use address as its key.
     *
     * @return ip in string format
     */
    public String getIp() {
<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (ip == null) {</span>
<span class="nc" id="L325">            ip = NetUtils.getIpByHost(host);</span>
        }
<span class="nc" id="L327">        return ip;</span>
    }

    public int getPort() {
<span class="nc" id="L331">        return port;</span>
    }

    public URL setPort(int port) {
<span class="nc" id="L335">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    public int getPort(int defaultPort) {
<span class="nc bnc" id="L339" title="All 2 branches missed.">        return port &lt;= 0 ? defaultPort : port;</span>
    }

    public String getAddress() {
<span class="nc bnc" id="L343" title="All 2 branches missed.">        return port &lt;= 0 ? host : host + &quot;:&quot; + port;</span>
    }

    public URL setAddress(String address) {
<span class="nc" id="L347">        int i = address.lastIndexOf(':');</span>
        String host;
<span class="nc" id="L349">        int port = this.port;</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (i &gt;= 0) {</span>
<span class="nc" id="L351">            host = address.substring(0, i);</span>
<span class="nc" id="L352">            port = Integer.parseInt(address.substring(i + 1));</span>
        } else {
<span class="nc" id="L354">            host = address;</span>
        }
<span class="nc" id="L356">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    public String getBackupAddress() {
<span class="nc" id="L360">        return getBackupAddress(0);</span>
    }

    public String getBackupAddress(int defaultPort) {
<span class="nc" id="L364">        StringBuilder address = new StringBuilder(appendDefaultPort(getAddress(), defaultPort));</span>
<span class="nc" id="L365">        String[] backups = getParameter(Constants.BACKUP_KEY, new String[0]);</span>
<span class="nc bnc" id="L366" title="All 4 branches missed.">        if (backups != null &amp;&amp; backups.length &gt; 0) {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">            for (String backup : backups) {</span>
<span class="nc" id="L368">                address.append(&quot;,&quot;);</span>
<span class="nc" id="L369">                address.append(appendDefaultPort(backup, defaultPort));</span>
            }
        }
<span class="nc" id="L372">        return address.toString();</span>
    }

    public List&lt;URL&gt; getBackupUrls() {
<span class="nc" id="L376">        List&lt;URL&gt; urls = new ArrayList&lt;URL&gt;();</span>
<span class="nc" id="L377">        urls.add(this);</span>
<span class="nc" id="L378">        String[] backups = getParameter(Constants.BACKUP_KEY, new String[0]);</span>
<span class="nc bnc" id="L379" title="All 4 branches missed.">        if (backups != null &amp;&amp; backups.length &gt; 0) {</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">            for (String backup : backups) {</span>
<span class="nc" id="L381">                urls.add(this.setAddress(backup));</span>
            }
        }
<span class="nc" id="L384">        return urls;</span>
    }

    private String appendDefaultPort(String address, int defaultPort) {
<span class="nc bnc" id="L388" title="All 6 branches missed.">        if (address != null &amp;&amp; address.length() &gt; 0</span>
                &amp;&amp; defaultPort &gt; 0) {
<span class="nc" id="L390">            int i = address.indexOf(':');</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">            if (i &lt; 0) {</span>
<span class="nc" id="L392">                return address + &quot;:&quot; + defaultPort;</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">            } else if (Integer.parseInt(address.substring(i + 1)) == 0) {</span>
<span class="nc" id="L394">                return address.substring(0, i + 1) + defaultPort;</span>
            }
        }
<span class="nc" id="L397">        return address;</span>
    }

    public String getPath() {
<span class="nc" id="L401">        return path;</span>
    }

    public URL setPath(String path) {
<span class="nc" id="L405">        return new URL(protocol, username, password, host, port, path, getParameters());</span>
    }

    public String getAbsolutePath() {
<span class="nc bnc" id="L409" title="All 4 branches missed.">        if (path != null &amp;&amp; !path.startsWith(&quot;/&quot;)) {</span>
<span class="nc" id="L410">            return &quot;/&quot; + path;</span>
        }
<span class="nc" id="L412">        return path;</span>
    }

    public Map&lt;String, String&gt; getParameters() {
<span class="nc" id="L416">        return parameters;</span>
    }

    public String getParameterAndDecoded(String key) {
<span class="nc" id="L420">        return getParameterAndDecoded(key, null);</span>
    }

    public String getParameterAndDecoded(String key, String defaultValue) {
<span class="nc" id="L424">        return decode(getParameter(key, defaultValue));</span>
    }

    public String getParameter(String key) {
<span class="nc" id="L428">        String value = parameters.get(key);</span>
<span class="nc bnc" id="L429" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L430">            value = parameters.get(Constants.DEFAULT_KEY_PREFIX + key);</span>
        }
<span class="nc" id="L432">        return value;</span>
    }

    public String getParameter(String key, String defaultValue) {
<span class="nc" id="L436">        String value = getParameter(key);</span>
<span class="nc bnc" id="L437" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L438">            return defaultValue;</span>
        }
<span class="nc" id="L440">        return value;</span>
    }

    public String[] getParameter(String key, String[] defaultValue) {
<span class="nc" id="L444">        String value = getParameter(key);</span>
<span class="nc bnc" id="L445" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L446">            return defaultValue;</span>
        }
<span class="nc" id="L448">        return Constants.COMMA_SPLIT_PATTERN.split(value);</span>
    }

    private Map&lt;String, Number&gt; getNumbers() {
<span class="nc bnc" id="L452" title="All 2 branches missed.">        if (numbers == null) { // concurrent initialization is tolerant</span>
<span class="nc" id="L453">            numbers = new ConcurrentHashMap&lt;String, Number&gt;();</span>
        }
<span class="nc" id="L455">        return numbers;</span>
    }

    private Map&lt;String, URL&gt; getUrls() {
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (urls == null) { // concurrent initialization is tolerant</span>
<span class="nc" id="L460">            urls = new ConcurrentHashMap&lt;String, URL&gt;();</span>
        }
<span class="nc" id="L462">        return urls;</span>
    }

    public URL getUrlParameter(String key) {
<span class="nc" id="L466">        URL u = getUrls().get(key);</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (u != null) {</span>
<span class="nc" id="L468">            return u;</span>
        }
<span class="nc" id="L470">        String value = getParameterAndDecoded(key);</span>
<span class="nc bnc" id="L471" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L472">            return null;</span>
        }
<span class="nc" id="L474">        u = URL.valueOf(value);</span>
<span class="nc" id="L475">        getUrls().put(key, u);</span>
<span class="nc" id="L476">        return u;</span>
    }

    public double getParameter(String key, double defaultValue) {
<span class="nc" id="L480">        Number n = getNumbers().get(key);</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L482">            return n.doubleValue();</span>
        }
<span class="nc" id="L484">        String value = getParameter(key);</span>
<span class="nc bnc" id="L485" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L486">            return defaultValue;</span>
        }
<span class="nc" id="L488">        double d = Double.parseDouble(value);</span>
<span class="nc" id="L489">        getNumbers().put(key, d);</span>
<span class="nc" id="L490">        return d;</span>
    }

    public float getParameter(String key, float defaultValue) {
<span class="nc" id="L494">        Number n = getNumbers().get(key);</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L496">            return n.floatValue();</span>
        }
<span class="nc" id="L498">        String value = getParameter(key);</span>
<span class="nc bnc" id="L499" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L500">            return defaultValue;</span>
        }
<span class="nc" id="L502">        float f = Float.parseFloat(value);</span>
<span class="nc" id="L503">        getNumbers().put(key, f);</span>
<span class="nc" id="L504">        return f;</span>
    }

    public long getParameter(String key, long defaultValue) {
<span class="nc" id="L508">        Number n = getNumbers().get(key);</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L510">            return n.longValue();</span>
        }
<span class="nc" id="L512">        String value = getParameter(key);</span>
<span class="nc bnc" id="L513" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L514">            return defaultValue;</span>
        }
<span class="nc" id="L516">        long l = Long.parseLong(value);</span>
<span class="nc" id="L517">        getNumbers().put(key, l);</span>
<span class="nc" id="L518">        return l;</span>
    }

    public int getParameter(String key, int defaultValue) {
<span class="nc" id="L522">        Number n = getNumbers().get(key);</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L524">            return n.intValue();</span>
        }
<span class="nc" id="L526">        String value = getParameter(key);</span>
<span class="nc bnc" id="L527" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L528">            return defaultValue;</span>
        }
<span class="nc" id="L530">        int i = Integer.parseInt(value);</span>
<span class="nc" id="L531">        getNumbers().put(key, i);</span>
<span class="nc" id="L532">        return i;</span>
    }

    public short getParameter(String key, short defaultValue) {
<span class="nc" id="L536">        Number n = getNumbers().get(key);</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L538">            return n.shortValue();</span>
        }
<span class="nc" id="L540">        String value = getParameter(key);</span>
<span class="nc bnc" id="L541" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L542">            return defaultValue;</span>
        }
<span class="nc" id="L544">        short s = Short.parseShort(value);</span>
<span class="nc" id="L545">        getNumbers().put(key, s);</span>
<span class="nc" id="L546">        return s;</span>
    }

    public byte getParameter(String key, byte defaultValue) {
<span class="nc" id="L550">        Number n = getNumbers().get(key);</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L552">            return n.byteValue();</span>
        }
<span class="nc" id="L554">        String value = getParameter(key);</span>
<span class="nc bnc" id="L555" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L556">            return defaultValue;</span>
        }
<span class="nc" id="L558">        byte b = Byte.parseByte(value);</span>
<span class="nc" id="L559">        getNumbers().put(key, b);</span>
<span class="nc" id="L560">        return b;</span>
    }

    public float getPositiveParameter(String key, float defaultValue) {
<span class="nc bnc" id="L564" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L565">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L567">        float value = getParameter(key, defaultValue);</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L569">            return defaultValue;</span>
        }
<span class="nc" id="L571">        return value;</span>
    }

    public double getPositiveParameter(String key, double defaultValue) {
<span class="nc bnc" id="L575" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L576">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L578">        double value = getParameter(key, defaultValue);</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L580">            return defaultValue;</span>
        }
<span class="nc" id="L582">        return value;</span>
    }

    public long getPositiveParameter(String key, long defaultValue) {
<span class="nc bnc" id="L586" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L587">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L589">        long value = getParameter(key, defaultValue);</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L591">            return defaultValue;</span>
        }
<span class="nc" id="L593">        return value;</span>
    }

    public int getPositiveParameter(String key, int defaultValue) {
<span class="nc bnc" id="L597" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L598">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L600">        int value = getParameter(key, defaultValue);</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L602">            return defaultValue;</span>
        }
<span class="nc" id="L604">        return value;</span>
    }

    public short getPositiveParameter(String key, short defaultValue) {
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L609">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L611">        short value = getParameter(key, defaultValue);</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L613">            return defaultValue;</span>
        }
<span class="nc" id="L615">        return value;</span>
    }

    public byte getPositiveParameter(String key, byte defaultValue) {
<span class="nc bnc" id="L619" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L620">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L622">        byte value = getParameter(key, defaultValue);</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L624">            return defaultValue;</span>
        }
<span class="nc" id="L626">        return value;</span>
    }

    public char getParameter(String key, char defaultValue) {
<span class="nc" id="L630">        String value = getParameter(key);</span>
<span class="nc bnc" id="L631" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L632">            return defaultValue;</span>
        }
<span class="nc" id="L634">        return value.charAt(0);</span>
    }

    public boolean getParameter(String key, boolean defaultValue) {
<span class="nc" id="L638">        String value = getParameter(key);</span>
<span class="nc bnc" id="L639" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L640">            return defaultValue;</span>
        }
<span class="nc" id="L642">        return Boolean.parseBoolean(value);</span>
    }

    public boolean hasParameter(String key) {
<span class="nc" id="L646">        String value = getParameter(key);</span>
<span class="nc bnc" id="L647" title="All 4 branches missed.">        return value != null &amp;&amp; value.length() &gt; 0;</span>
    }

    public String getMethodParameterAndDecoded(String method, String key) {
<span class="nc" id="L651">        return URL.decode(getMethodParameter(method, key));</span>
    }

    public String getMethodParameterAndDecoded(String method, String key, String defaultValue) {
<span class="nc" id="L655">        return URL.decode(getMethodParameter(method, key, defaultValue));</span>
    }

    public String getMethodParameter(String method, String key) {
<span class="nc" id="L659">        String value = parameters.get(method + &quot;.&quot; + key);</span>
<span class="nc bnc" id="L660" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L661">            return getParameter(key);</span>
        }
<span class="nc" id="L663">        return value;</span>
    }

    public String getMethodParameter(String method, String key, String defaultValue) {
<span class="nc" id="L667">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L668" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L669">            return defaultValue;</span>
        }
<span class="nc" id="L671">        return value;</span>
    }

    public double getMethodParameter(String method, String key, double defaultValue) {
<span class="nc" id="L675">        String methodKey = method + &quot;.&quot; + key;</span>
<span class="nc" id="L676">        Number n = getNumbers().get(methodKey);</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L678">            return n.intValue();</span>
        }
<span class="nc" id="L680">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L681" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L682">            return defaultValue;</span>
        }
<span class="nc" id="L684">        double d = Double.parseDouble(value);</span>
<span class="nc" id="L685">        getNumbers().put(methodKey, d);</span>
<span class="nc" id="L686">        return d;</span>
    }

    public float getMethodParameter(String method, String key, float defaultValue) {
<span class="nc" id="L690">        String methodKey = method + &quot;.&quot; + key;</span>
<span class="nc" id="L691">        Number n = getNumbers().get(methodKey);</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L693">            return n.intValue();</span>
        }
<span class="nc" id="L695">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L696" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L697">            return defaultValue;</span>
        }
<span class="nc" id="L699">        float f = Float.parseFloat(value);</span>
<span class="nc" id="L700">        getNumbers().put(methodKey, f);</span>
<span class="nc" id="L701">        return f;</span>
    }

    public long getMethodParameter(String method, String key, long defaultValue) {
<span class="nc" id="L705">        String methodKey = method + &quot;.&quot; + key;</span>
<span class="nc" id="L706">        Number n = getNumbers().get(methodKey);</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L708">            return n.intValue();</span>
        }
<span class="nc" id="L710">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L711" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L712">            return defaultValue;</span>
        }
<span class="nc" id="L714">        long l = Long.parseLong(value);</span>
<span class="nc" id="L715">        getNumbers().put(methodKey, l);</span>
<span class="nc" id="L716">        return l;</span>
    }

    public int getMethodParameter(String method, String key, int defaultValue) {
<span class="nc" id="L720">        String methodKey = method + &quot;.&quot; + key;</span>
<span class="nc" id="L721">        Number n = getNumbers().get(methodKey);</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L723">            return n.intValue();</span>
        }
<span class="nc" id="L725">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L726" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L727">            return defaultValue;</span>
        }
<span class="nc" id="L729">        int i = Integer.parseInt(value);</span>
<span class="nc" id="L730">        getNumbers().put(methodKey, i);</span>
<span class="nc" id="L731">        return i;</span>
    }

    public short getMethodParameter(String method, String key, short defaultValue) {
<span class="nc" id="L735">        String methodKey = method + &quot;.&quot; + key;</span>
<span class="nc" id="L736">        Number n = getNumbers().get(methodKey);</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L738">            return n.shortValue();</span>
        }
<span class="nc" id="L740">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L741" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L742">            return defaultValue;</span>
        }
<span class="nc" id="L744">        short s = Short.parseShort(value);</span>
<span class="nc" id="L745">        getNumbers().put(methodKey, s);</span>
<span class="nc" id="L746">        return s;</span>
    }

    public byte getMethodParameter(String method, String key, byte defaultValue) {
<span class="nc" id="L750">        String methodKey = method + &quot;.&quot; + key;</span>
<span class="nc" id="L751">        Number n = getNumbers().get(methodKey);</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">        if (n != null) {</span>
<span class="nc" id="L753">            return n.byteValue();</span>
        }
<span class="nc" id="L755">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L756" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L757">            return defaultValue;</span>
        }
<span class="nc" id="L759">        byte b = Byte.parseByte(value);</span>
<span class="nc" id="L760">        getNumbers().put(methodKey, b);</span>
<span class="nc" id="L761">        return b;</span>
    }

    public double getMethodPositiveParameter(String method, String key, double defaultValue) {
<span class="nc bnc" id="L765" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L766">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L768">        double value = getMethodParameter(method, key, defaultValue);</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L770">            return defaultValue;</span>
        }
<span class="nc" id="L772">        return value;</span>
    }

    public float getMethodPositiveParameter(String method, String key, float defaultValue) {
<span class="nc bnc" id="L776" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L777">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L779">        float value = getMethodParameter(method, key, defaultValue);</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L781">            return defaultValue;</span>
        }
<span class="nc" id="L783">        return value;</span>
    }

    public long getMethodPositiveParameter(String method, String key, long defaultValue) {
<span class="nc bnc" id="L787" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L788">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L790">        long value = getMethodParameter(method, key, defaultValue);</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L792">            return defaultValue;</span>
        }
<span class="nc" id="L794">        return value;</span>
    }

    public int getMethodPositiveParameter(String method, String key, int defaultValue) {
<span class="nc bnc" id="L798" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L799">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L801">        int value = getMethodParameter(method, key, defaultValue);</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L803">            return defaultValue;</span>
        }
<span class="nc" id="L805">        return value;</span>
    }

    public short getMethodPositiveParameter(String method, String key, short defaultValue) {
<span class="nc bnc" id="L809" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L810">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L812">        short value = getMethodParameter(method, key, defaultValue);</span>
<span class="nc bnc" id="L813" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L814">            return defaultValue;</span>
        }
<span class="nc" id="L816">        return value;</span>
    }

    public byte getMethodPositiveParameter(String method, String key, byte defaultValue) {
<span class="nc bnc" id="L820" title="All 2 branches missed.">        if (defaultValue &lt;= 0) {</span>
<span class="nc" id="L821">            throw new IllegalArgumentException(&quot;defaultValue &lt;= 0&quot;);</span>
        }
<span class="nc" id="L823">        byte value = getMethodParameter(method, key, defaultValue);</span>
<span class="nc bnc" id="L824" title="All 2 branches missed.">        if (value &lt;= 0) {</span>
<span class="nc" id="L825">            return defaultValue;</span>
        }
<span class="nc" id="L827">        return value;</span>
    }

    public char getMethodParameter(String method, String key, char defaultValue) {
<span class="nc" id="L831">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L832" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L833">            return defaultValue;</span>
        }
<span class="nc" id="L835">        return value.charAt(0);</span>
    }

    public boolean getMethodParameter(String method, String key, boolean defaultValue) {
<span class="nc" id="L839">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L840" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L841">            return defaultValue;</span>
        }
<span class="nc" id="L843">        return Boolean.parseBoolean(value);</span>
    }

    public boolean hasMethodParameter(String method, String key) {
<span class="nc bnc" id="L847" title="All 2 branches missed.">        if (method == null) {</span>
<span class="nc" id="L848">            String suffix = &quot;.&quot; + key;</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">            for (String fullKey : parameters.keySet()) {</span>
<span class="nc bnc" id="L850" title="All 2 branches missed.">                if (fullKey.endsWith(suffix)) {</span>
<span class="nc" id="L851">                    return true;</span>
                }
<span class="nc" id="L853">            }</span>
<span class="nc" id="L854">            return false;</span>
        }
<span class="nc bnc" id="L856" title="All 2 branches missed.">        if (key == null) {</span>
<span class="nc" id="L857">            String prefix = method + &quot;.&quot;;</span>
<span class="nc bnc" id="L858" title="All 2 branches missed.">            for (String fullKey : parameters.keySet()) {</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">                if (fullKey.startsWith(prefix)) {</span>
<span class="nc" id="L860">                    return true;</span>
                }
<span class="nc" id="L862">            }</span>
<span class="nc" id="L863">            return false;</span>
        }
<span class="nc" id="L865">        String value = getMethodParameter(method, key);</span>
<span class="nc bnc" id="L866" title="All 4 branches missed.">        return value != null &amp;&amp; value.length() &gt; 0;</span>
    }

    public boolean isLocalHost() {
<span class="nc bnc" id="L870" title="All 4 branches missed.">        return NetUtils.isLocalHost(host) || getParameter(Constants.LOCALHOST_KEY, false);</span>
    }

    public boolean isAnyHost() {
<span class="nc bnc" id="L874" title="All 4 branches missed.">        return Constants.ANYHOST_VALUE.equals(host) || getParameter(Constants.ANYHOST_KEY, false);</span>
    }

    public URL addParameterAndEncoded(String key, String value) {
<span class="nc bnc" id="L878" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L879">            return this;</span>
        }
<span class="nc" id="L881">        return addParameter(key, encode(value));</span>
    }

    public URL addParameter(String key, boolean value) {
<span class="nc" id="L885">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, char value) {
<span class="nc" id="L889">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, byte value) {
<span class="nc" id="L893">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, short value) {
<span class="nc" id="L897">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, int value) {
<span class="nc" id="L901">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, long value) {
<span class="nc" id="L905">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, float value) {
<span class="nc" id="L909">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, double value) {
<span class="nc" id="L913">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, Enum&lt;?&gt; value) {
<span class="nc bnc" id="L917" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L918">            return this;</span>
        }
<span class="nc" id="L920">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, Number value) {
<span class="nc bnc" id="L924" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L925">            return this;</span>
        }
<span class="nc" id="L927">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, CharSequence value) {
<span class="nc bnc" id="L931" title="All 4 branches missed.">        if (value == null || value.length() == 0) {</span>
<span class="nc" id="L932">            return this;</span>
        }
<span class="nc" id="L934">        return addParameter(key, String.valueOf(value));</span>
    }

    public URL addParameter(String key, String value) {
<span class="nc bnc" id="L938" title="All 6 branches missed.">        if (key == null || key.length() == 0</span>
<span class="nc bnc" id="L939" title="All 2 branches missed.">                || value == null || value.length() == 0) {</span>
<span class="nc" id="L940">            return this;</span>
        }
        // if value doesn't change, return immediately
<span class="nc bnc" id="L943" title="All 2 branches missed.">        if (value.equals(getParameters().get(key))) { // value != null</span>
<span class="nc" id="L944">            return this;</span>
        }

<span class="nc" id="L947">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(getParameters());</span>
<span class="nc" id="L948">        map.put(key, value);</span>
<span class="nc" id="L949">        return new URL(protocol, username, password, host, port, path, map);</span>
    }

    public URL addParameterIfAbsent(String key, String value) {
<span class="nc bnc" id="L953" title="All 6 branches missed.">        if (key == null || key.length() == 0</span>
<span class="nc bnc" id="L954" title="All 2 branches missed.">                || value == null || value.length() == 0) {</span>
<span class="nc" id="L955">            return this;</span>
        }
<span class="nc bnc" id="L957" title="All 2 branches missed.">        if (hasParameter(key)) {</span>
<span class="nc" id="L958">            return this;</span>
        }
<span class="nc" id="L960">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(getParameters());</span>
<span class="nc" id="L961">        map.put(key, value);</span>
<span class="nc" id="L962">        return new URL(protocol, username, password, host, port, path, map);</span>
    }

    /**
     * Add parameters to a new url.
     *
     * @param parameters parameters in key-value pairs
     * @return A new URL
     */
    public URL addParameters(Map&lt;String, String&gt; parameters) {
<span class="nc bnc" id="L972" title="All 4 branches missed.">        if (parameters == null || parameters.size() == 0) {</span>
<span class="nc" id="L973">            return this;</span>
        }

<span class="nc" id="L976">        boolean hasAndEqual = true;</span>
<span class="nc bnc" id="L977" title="All 2 branches missed.">        for (Map.Entry&lt;String, String&gt; entry : parameters.entrySet()) {</span>
<span class="nc" id="L978">            String value = getParameters().get(entry.getKey());</span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">                if (entry.getValue() != null) {</span>
<span class="nc" id="L981">                    hasAndEqual = false;</span>
<span class="nc" id="L982">                    break;</span>
                }
            } else {
<span class="nc bnc" id="L985" title="All 2 branches missed.">                if (!value.equals(entry.getValue())) {</span>
<span class="nc" id="L986">                    hasAndEqual = false;</span>
<span class="nc" id="L987">                    break;</span>
                }
            }
<span class="nc" id="L990">        }</span>
        // return immediately if there's no change
<span class="nc bnc" id="L992" title="All 2 branches missed.">        if (hasAndEqual) {</span>
<span class="nc" id="L993">            return this;</span>
        }

<span class="nc" id="L996">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(getParameters());</span>
<span class="nc" id="L997">        map.putAll(parameters);</span>
<span class="nc" id="L998">        return new URL(protocol, username, password, host, port, path, map);</span>
    }

    public URL addParametersIfAbsent(Map&lt;String, String&gt; parameters) {
<span class="nc bnc" id="L1002" title="All 4 branches missed.">        if (parameters == null || parameters.size() == 0) {</span>
<span class="nc" id="L1003">            return this;</span>
        }
<span class="nc" id="L1005">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(parameters);</span>
<span class="nc" id="L1006">        map.putAll(getParameters());</span>
<span class="nc" id="L1007">        return new URL(protocol, username, password, host, port, path, map);</span>
    }

    public URL addParameters(String... pairs) {
<span class="nc bnc" id="L1011" title="All 4 branches missed.">        if (pairs == null || pairs.length == 0) {</span>
<span class="nc" id="L1012">            return this;</span>
        }
<span class="nc bnc" id="L1014" title="All 2 branches missed.">        if (pairs.length % 2 != 0) {</span>
<span class="nc" id="L1015">            throw new IllegalArgumentException(&quot;Map pairs can not be odd number.&quot;);</span>
        }
<span class="nc" id="L1017">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L1018">        int len = pairs.length / 2;</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="nc" id="L1020">            map.put(pairs[2 * i], pairs[2 * i + 1]);</span>
        }
<span class="nc" id="L1022">        return addParameters(map);</span>
    }

    public URL addParameterString(String query) {
<span class="nc bnc" id="L1026" title="All 4 branches missed.">        if (query == null || query.length() == 0) {</span>
<span class="nc" id="L1027">            return this;</span>
        }
<span class="nc" id="L1029">        return addParameters(StringUtils.parseQueryString(query));</span>
    }

    public URL removeParameter(String key) {
<span class="nc bnc" id="L1033" title="All 4 branches missed.">        if (key == null || key.length() == 0) {</span>
<span class="nc" id="L1034">            return this;</span>
        }
<span class="nc" id="L1036">        return removeParameters(key);</span>
    }

    public URL removeParameters(Collection&lt;String&gt; keys) {
<span class="nc bnc" id="L1040" title="All 4 branches missed.">        if (keys == null || keys.isEmpty()) {</span>
<span class="nc" id="L1041">            return this;</span>
        }
<span class="nc" id="L1043">        return removeParameters(keys.toArray(new String[0]));</span>
    }

    public URL removeParameters(String... keys) {
<span class="nc bnc" id="L1047" title="All 4 branches missed.">        if (keys == null || keys.length == 0) {</span>
<span class="nc" id="L1048">            return this;</span>
        }
<span class="nc" id="L1050">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(getParameters());</span>
<span class="nc bnc" id="L1051" title="All 2 branches missed.">        for (String key : keys) {</span>
<span class="nc" id="L1052">            map.remove(key);</span>
        }
<span class="nc bnc" id="L1054" title="All 2 branches missed.">        if (map.size() == getParameters().size()) {</span>
<span class="nc" id="L1055">            return this;</span>
        }
<span class="nc" id="L1057">        return new URL(protocol, username, password, host, port, path, map);</span>
    }

    public URL clearParameters() {
<span class="nc" id="L1061">        return new URL(protocol, username, password, host, port, path, new HashMap&lt;String, String&gt;());</span>
    }

    public String getRawParameter(String key) {
<span class="nc bnc" id="L1065" title="All 2 branches missed.">        if (&quot;protocol&quot;.equals(key)) {</span>
<span class="nc" id="L1066">            return protocol;</span>
        }
<span class="nc bnc" id="L1068" title="All 2 branches missed.">        if (&quot;username&quot;.equals(key)) {</span>
<span class="nc" id="L1069">            return username;</span>
        }
<span class="nc bnc" id="L1071" title="All 2 branches missed.">        if (&quot;password&quot;.equals(key)) {</span>
<span class="nc" id="L1072">            return password;</span>
        }
<span class="nc bnc" id="L1074" title="All 2 branches missed.">        if (&quot;host&quot;.equals(key)) {</span>
<span class="nc" id="L1075">            return host;</span>
        }
<span class="nc bnc" id="L1077" title="All 2 branches missed.">        if (&quot;port&quot;.equals(key)) {</span>
<span class="nc" id="L1078">            return String.valueOf(port);</span>
        }
<span class="nc bnc" id="L1080" title="All 2 branches missed.">        if (&quot;path&quot;.equals(key)) {</span>
<span class="nc" id="L1081">            return path;</span>
        }
<span class="nc" id="L1083">        return getParameter(key);</span>
    }

    public Map&lt;String, String&gt; toMap() {
<span class="nc" id="L1087">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(parameters);</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">        if (protocol != null) {</span>
<span class="nc" id="L1089">            map.put(&quot;protocol&quot;, protocol);</span>
        }
<span class="nc bnc" id="L1091" title="All 2 branches missed.">        if (username != null) {</span>
<span class="nc" id="L1092">            map.put(&quot;username&quot;, username);</span>
        }
<span class="nc bnc" id="L1094" title="All 2 branches missed.">        if (password != null) {</span>
<span class="nc" id="L1095">            map.put(&quot;password&quot;, password);</span>
        }
<span class="nc bnc" id="L1097" title="All 2 branches missed.">        if (host != null) {</span>
<span class="nc" id="L1098">            map.put(&quot;host&quot;, host);</span>
        }
<span class="nc bnc" id="L1100" title="All 2 branches missed.">        if (port &gt; 0) {</span>
<span class="nc" id="L1101">            map.put(&quot;port&quot;, String.valueOf(port));</span>
        }
<span class="nc bnc" id="L1103" title="All 2 branches missed.">        if (path != null) {</span>
<span class="nc" id="L1104">            map.put(&quot;path&quot;, path);</span>
        }
<span class="nc" id="L1106">        return map;</span>
    }

    @Override
    public String toString() {
<span class="nc bnc" id="L1111" title="All 2 branches missed.">        if (string != null) {</span>
<span class="nc" id="L1112">            return string;</span>
        }
<span class="nc" id="L1114">        return string = buildString(false, true); // no show username and password</span>
    }

    public String toString(String... parameters) {
<span class="nc" id="L1118">        return buildString(false, true, parameters); // no show username and password</span>
    }

    public String toIdentityString() {
<span class="nc bnc" id="L1122" title="All 2 branches missed.">        if (identity != null) {</span>
<span class="nc" id="L1123">            return identity;</span>
        }
<span class="nc" id="L1125">        return identity = buildString(true, false); // only return identity message, see the method &quot;equals&quot; and &quot;hashCode&quot;</span>
    }

    public String toIdentityString(String... parameters) {
<span class="nc" id="L1129">        return buildString(true, false, parameters); // only return identity message, see the method &quot;equals&quot; and &quot;hashCode&quot;</span>
    }

    public String toFullString() {
<span class="nc bnc" id="L1133" title="All 2 branches missed.">        if (full != null) {</span>
<span class="nc" id="L1134">            return full;</span>
        }
<span class="nc" id="L1136">        return full = buildString(true, true);</span>
    }

    public String toFullString(String... parameters) {
<span class="nc" id="L1140">        return buildString(true, true, parameters);</span>
    }

    public String toParameterString() {
<span class="nc bnc" id="L1144" title="All 2 branches missed.">        if (parameter != null) {</span>
<span class="nc" id="L1145">            return parameter;</span>
        }
<span class="nc" id="L1147">        return parameter = toParameterString(new String[0]);</span>
    }

    public String toParameterString(String... parameters) {
<span class="nc" id="L1151">        StringBuilder buf = new StringBuilder();</span>
<span class="nc" id="L1152">        buildParameters(buf, false, parameters);</span>
<span class="nc" id="L1153">        return buf.toString();</span>
    }

    private void buildParameters(StringBuilder buf, boolean concat, String[] parameters) {
<span class="nc bnc" id="L1157" title="All 4 branches missed.">        if (getParameters() != null &amp;&amp; getParameters().size() &gt; 0) {</span>
<span class="nc bnc" id="L1158" title="All 4 branches missed.">            List&lt;String&gt; includes = (parameters == null || parameters.length == 0 ? null : Arrays.asList(parameters));</span>
<span class="nc" id="L1159">            boolean first = true;</span>
<span class="nc bnc" id="L1160" title="All 2 branches missed.">            for (Map.Entry&lt;String, String&gt; entry : new TreeMap&lt;String, String&gt;(getParameters()).entrySet()) {</span>
<span class="nc bnc" id="L1161" title="All 6 branches missed.">                if (entry.getKey() != null &amp;&amp; entry.getKey().length() &gt; 0</span>
<span class="nc bnc" id="L1162" title="All 2 branches missed.">                        &amp;&amp; (includes == null || includes.contains(entry.getKey()))) {</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">                    if (first) {</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">                        if (concat) {</span>
<span class="nc" id="L1165">                            buf.append(&quot;?&quot;);</span>
                        }
<span class="nc" id="L1167">                        first = false;</span>
                    } else {
<span class="nc" id="L1169">                        buf.append(&quot;&amp;&quot;);</span>
                    }
<span class="nc" id="L1171">                    buf.append(entry.getKey());</span>
<span class="nc" id="L1172">                    buf.append(&quot;=&quot;);</span>
<span class="nc bnc" id="L1173" title="All 2 branches missed.">                    buf.append(entry.getValue() == null ? &quot;&quot; : entry.getValue().trim());</span>
                }
<span class="nc" id="L1175">            }</span>
        }
<span class="nc" id="L1177">    }</span>

    private String buildString(boolean appendUser, boolean appendParameter, String... parameters) {
<span class="nc" id="L1180">        return buildString(appendUser, appendParameter, false, false, parameters);</span>
    }

    private String buildString(boolean appendUser, boolean appendParameter, boolean useIP, boolean useService, String... parameters) {
<span class="nc" id="L1184">        StringBuilder buf = new StringBuilder();</span>
<span class="nc bnc" id="L1185" title="All 4 branches missed.">        if (protocol != null &amp;&amp; protocol.length() &gt; 0) {</span>
<span class="nc" id="L1186">            buf.append(protocol);</span>
<span class="nc" id="L1187">            buf.append(&quot;://&quot;);</span>
        }
<span class="nc bnc" id="L1189" title="All 6 branches missed.">        if (appendUser &amp;&amp; username != null &amp;&amp; username.length() &gt; 0) {</span>
<span class="nc" id="L1190">            buf.append(username);</span>
<span class="nc bnc" id="L1191" title="All 4 branches missed.">            if (password != null &amp;&amp; password.length() &gt; 0) {</span>
<span class="nc" id="L1192">                buf.append(&quot;:&quot;);</span>
<span class="nc" id="L1193">                buf.append(password);</span>
            }
<span class="nc" id="L1195">            buf.append(&quot;@&quot;);</span>
        }
        String host;
<span class="nc bnc" id="L1198" title="All 2 branches missed.">        if (useIP) {</span>
<span class="nc" id="L1199">            host = getIp();</span>
        } else {
<span class="nc" id="L1201">            host = getHost();</span>
        }
<span class="nc bnc" id="L1203" title="All 4 branches missed.">        if (host != null &amp;&amp; host.length() &gt; 0) {</span>
<span class="nc" id="L1204">            buf.append(host);</span>
<span class="nc bnc" id="L1205" title="All 2 branches missed.">            if (port &gt; 0) {</span>
<span class="nc" id="L1206">                buf.append(&quot;:&quot;);</span>
<span class="nc" id="L1207">                buf.append(port);</span>
            }
        }
        String path;
<span class="nc bnc" id="L1211" title="All 2 branches missed.">        if (useService) {</span>
<span class="nc" id="L1212">            path = getServiceKey();</span>
        } else {
<span class="nc" id="L1214">            path = getPath();</span>
        }
<span class="nc bnc" id="L1216" title="All 4 branches missed.">        if (path != null &amp;&amp; path.length() &gt; 0) {</span>
<span class="nc" id="L1217">            buf.append(&quot;/&quot;);</span>
<span class="nc" id="L1218">            buf.append(path);</span>
        }
<span class="nc bnc" id="L1220" title="All 2 branches missed.">        if (appendParameter) {</span>
<span class="nc" id="L1221">            buildParameters(buf, true, parameters);</span>
        }
<span class="nc" id="L1223">        return buf.toString();</span>
    }

    public java.net.URL toJavaURL() {
        try {
<span class="nc" id="L1228">            return new java.net.URL(toString());</span>
<span class="nc" id="L1229">        } catch (MalformedURLException e) {</span>
<span class="nc" id="L1230">            throw new IllegalStateException(e.getMessage(), e);</span>
        }
    }

    public InetSocketAddress toInetSocketAddress() {
<span class="nc" id="L1235">        return new InetSocketAddress(host, port);</span>
    }

    public String getServiceKey() {
<span class="nc" id="L1239">        String inf = getServiceInterface();</span>
<span class="nc bnc" id="L1240" title="All 2 branches missed.">        if (inf == null) {</span>
<span class="nc" id="L1241">            return null;</span>
        }
<span class="nc" id="L1243">        StringBuilder buf = new StringBuilder();</span>
<span class="nc" id="L1244">        String group = getParameter(Constants.GROUP_KEY);</span>
<span class="nc bnc" id="L1245" title="All 4 branches missed.">        if (group != null &amp;&amp; group.length() &gt; 0) {</span>
<span class="nc" id="L1246">            buf.append(group).append(&quot;/&quot;);</span>
        }
<span class="nc" id="L1248">        buf.append(inf);</span>
<span class="nc" id="L1249">        String version = getParameter(Constants.VERSION_KEY);</span>
<span class="nc bnc" id="L1250" title="All 4 branches missed.">        if (version != null &amp;&amp; version.length() &gt; 0) {</span>
<span class="nc" id="L1251">            buf.append(&quot;:&quot;).append(version);</span>
        }
<span class="nc" id="L1253">        return buf.toString();</span>
    }

    public String toServiceStringWithoutResolving() {
<span class="nc" id="L1257">        return buildString(true, false, false, true);</span>
    }

    public String toServiceString() {
<span class="nc" id="L1261">        return buildString(true, false, true, true);</span>
    }

    @Deprecated
    public String getServiceName() {
<span class="nc" id="L1266">        return getServiceInterface();</span>
    }

    public String getServiceInterface() {
<span class="nc" id="L1270">        return getParameter(Constants.INTERFACE_KEY, path);</span>
    }

    public URL setServiceInterface(String service) {
<span class="nc" id="L1274">        return addParameter(Constants.INTERFACE_KEY, service);</span>
    }

    /**
     * @see #getParameter(String, int)
     * @deprecated Replace to &lt;code&gt;getParameter(String, int)&lt;/code&gt;
     */
    @Deprecated
    public int getIntParameter(String key) {
<span class="nc" id="L1283">        return getParameter(key, 0);</span>
    }

    /**
     * @see #getParameter(String, int)
     * @deprecated Replace to &lt;code&gt;getParameter(String, int)&lt;/code&gt;
     */
    @Deprecated
    public int getIntParameter(String key, int defaultValue) {
<span class="nc" id="L1292">        return getParameter(key, defaultValue);</span>
    }

    /**
     * @see #getPositiveParameter(String, int)
     * @deprecated Replace to &lt;code&gt;getPositiveParameter(String, int)&lt;/code&gt;
     */
    @Deprecated
    public int getPositiveIntParameter(String key, int defaultValue) {
<span class="nc" id="L1301">        return getPositiveParameter(key, defaultValue);</span>
    }

    /**
     * @see #getParameter(String, boolean)
     * @deprecated Replace to &lt;code&gt;getParameter(String, boolean)&lt;/code&gt;
     */
    @Deprecated
    public boolean getBooleanParameter(String key) {
<span class="nc" id="L1310">        return getParameter(key, false);</span>
    }

    /**
     * @see #getParameter(String, boolean)
     * @deprecated Replace to &lt;code&gt;getParameter(String, boolean)&lt;/code&gt;
     */
    @Deprecated
    public boolean getBooleanParameter(String key, boolean defaultValue) {
<span class="nc" id="L1319">        return getParameter(key, defaultValue);</span>
    }

    /**
     * @see #getMethodParameter(String, String, int)
     * @deprecated Replace to &lt;code&gt;getMethodParameter(String, String, int)&lt;/code&gt;
     */
    @Deprecated
    public int getMethodIntParameter(String method, String key) {
<span class="nc" id="L1328">        return getMethodParameter(method, key, 0);</span>
    }

    /**
     * @see #getMethodParameter(String, String, int)
     * @deprecated Replace to &lt;code&gt;getMethodParameter(String, String, int)&lt;/code&gt;
     */
    @Deprecated
    public int getMethodIntParameter(String method, String key, int defaultValue) {
<span class="nc" id="L1337">        return getMethodParameter(method, key, defaultValue);</span>
    }

    /**
     * @see #getMethodPositiveParameter(String, String, int)
     * @deprecated Replace to &lt;code&gt;getMethodPositiveParameter(String, String, int)&lt;/code&gt;
     */
    @Deprecated
    public int getMethodPositiveIntParameter(String method, String key, int defaultValue) {
<span class="nc" id="L1346">        return getMethodPositiveParameter(method, key, defaultValue);</span>
    }

    /**
     * @see #getMethodParameter(String, String, boolean)
     * @deprecated Replace to &lt;code&gt;getMethodParameter(String, String, boolean)&lt;/code&gt;
     */
    @Deprecated
    public boolean getMethodBooleanParameter(String method, String key) {
<span class="nc" id="L1355">        return getMethodParameter(method, key, false);</span>
    }

    /**
     * @see #getMethodParameter(String, String, boolean)
     * @deprecated Replace to &lt;code&gt;getMethodParameter(String, String, boolean)&lt;/code&gt;
     */
    @Deprecated
    public boolean getMethodBooleanParameter(String method, String key, boolean defaultValue) {
<span class="nc" id="L1364">        return getMethodParameter(method, key, defaultValue);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1369">        final int prime = 31;</span>
<span class="nc" id="L1370">        int result = 1;</span>
<span class="nc bnc" id="L1371" title="All 2 branches missed.">        result = prime * result + ((host == null) ? 0 : host.hashCode());</span>
<span class="nc bnc" id="L1372" title="All 2 branches missed.">        result = prime * result + ((parameters == null) ? 0 : parameters.hashCode());</span>
<span class="nc bnc" id="L1373" title="All 2 branches missed.">        result = prime * result + ((password == null) ? 0 : password.hashCode());</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">        result = prime * result + ((path == null) ? 0 : path.hashCode());</span>
<span class="nc" id="L1375">        result = prime * result + port;</span>
<span class="nc bnc" id="L1376" title="All 2 branches missed.">        result = prime * result + ((protocol == null) ? 0 : protocol.hashCode());</span>
<span class="nc bnc" id="L1377" title="All 2 branches missed.">        result = prime * result + ((username == null) ? 0 : username.hashCode());</span>
<span class="nc" id="L1378">        return result;</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="nc bnc" id="L1383" title="All 2 branches missed.">        if (this == obj) {</span>
<span class="nc" id="L1384">            return true;</span>
        }
<span class="nc bnc" id="L1386" title="All 2 branches missed.">        if (obj == null) {</span>
<span class="nc" id="L1387">            return false;</span>
        }
<span class="nc bnc" id="L1389" title="All 2 branches missed.">        if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L1390">            return false;</span>
        }
<span class="nc" id="L1392">        URL other = (URL) obj;</span>
<span class="nc bnc" id="L1393" title="All 2 branches missed.">        if (host == null) {</span>
<span class="nc bnc" id="L1394" title="All 2 branches missed.">            if (other.host != null) {</span>
<span class="nc" id="L1395">                return false;</span>
            }
<span class="nc bnc" id="L1397" title="All 2 branches missed.">        } else if (!host.equals(other.host)) {</span>
<span class="nc" id="L1398">            return false;</span>
        }
<span class="nc bnc" id="L1400" title="All 2 branches missed.">        if (parameters == null) {</span>
<span class="nc bnc" id="L1401" title="All 2 branches missed.">            if (other.parameters != null) {</span>
<span class="nc" id="L1402">                return false;</span>
            }
<span class="nc bnc" id="L1404" title="All 2 branches missed.">        } else if (!parameters.equals(other.parameters)) {</span>
<span class="nc" id="L1405">            return false;</span>
        }
<span class="nc bnc" id="L1407" title="All 2 branches missed.">        if (password == null) {</span>
<span class="nc bnc" id="L1408" title="All 2 branches missed.">            if (other.password != null) {</span>
<span class="nc" id="L1409">                return false;</span>
            }
<span class="nc bnc" id="L1411" title="All 2 branches missed.">        } else if (!password.equals(other.password)) {</span>
<span class="nc" id="L1412">            return false;</span>
        }
<span class="nc bnc" id="L1414" title="All 2 branches missed.">        if (path == null) {</span>
<span class="nc bnc" id="L1415" title="All 2 branches missed.">            if (other.path != null) {</span>
<span class="nc" id="L1416">                return false;</span>
            }
<span class="nc bnc" id="L1418" title="All 2 branches missed.">        } else if (!path.equals(other.path)) {</span>
<span class="nc" id="L1419">            return false;</span>
        }
<span class="nc bnc" id="L1421" title="All 2 branches missed.">        if (port != other.port) {</span>
<span class="nc" id="L1422">            return false;</span>
        }
<span class="nc bnc" id="L1424" title="All 2 branches missed.">        if (protocol == null) {</span>
<span class="nc bnc" id="L1425" title="All 2 branches missed.">            if (other.protocol != null) {</span>
<span class="nc" id="L1426">                return false;</span>
            }
<span class="nc bnc" id="L1428" title="All 2 branches missed.">        } else if (!protocol.equals(other.protocol)) {</span>
<span class="nc" id="L1429">            return false;</span>
        }
<span class="nc bnc" id="L1431" title="All 2 branches missed.">        if (username == null) {</span>
<span class="nc bnc" id="L1432" title="All 2 branches missed.">            if (other.username != null) {</span>
<span class="nc" id="L1433">                return false;</span>
            }
<span class="nc bnc" id="L1435" title="All 2 branches missed.">        } else if (!username.equals(other.username)) {</span>
<span class="nc" id="L1436">            return false;</span>
        }
<span class="nc" id="L1438">        return true;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>