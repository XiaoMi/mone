import{d as h,x as H,_ as B,c as F,i as I,w as u,h as A,e as D,v as z,f as t,t as v,k as C,a as q,r as y,o as M,y as x,g as r,l as J,E as p,T as Q,F as U,q as L,s as W,j}from"./index-Co6ij2vp.js";import{S as E}from"./index-BYulWOv-.js";import{i as X}from"./agent-D_xH4Fa1.js";const Y=n=>E({url:"/v1/tasks",method:"get",params:n}),Z=n=>E({url:`/v1/tasks/${n}`,method:"get"}),$=n=>E({url:"/v1/tasks/execute",method:"post",data:n}),ee=n=>E({url:"/v1/tasks",method:"post",data:n}),te=n=>E({url:`/v1/tasks/${n.taskUuid}/update`,method:"put",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}),le=h({__name:"TaskDetailDrawer",props:{modelValue:{type:Boolean,required:!0},task:{type:[Object,null],required:!0}},emits:["update:modelValue"],setup(n,{expose:e,emit:o}){e();const l=n,k=o,b=H({get:()=>l.modelValue,set:m=>k("update:modelValue",m)}),_={props:l,emit:k,visible:b,getStatusType:m=>({running:"primary",completed:"success",failed:"danger",pending:"warning"})[m]||"info",formatDate:m=>new Date(m).toLocaleString()};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),se={key:0,class:"task-detail"},ae={class:"detail-item"},ne={class:"detail-item"},oe={class:"detail-item"},ie={class:"detail-item"},re={class:"detail-item"},ue={class:"detail-item"},de={class:"detail-item"},ce={class:"detail-item"};function me(n,e,o,l,k,b){const d=F("el-drawer");return A(),I(d,{modelValue:l.visible,"onUpdate:modelValue":e[0]||(e[0]=i=>l.visible=i),title:"任务详情",size:"500px","destroy-on-close":!0},{default:u(()=>[o.task?(A(),D("div",se,[t("div",ae,[e[1]||(e[1]=t("label",null,"任务ID：",-1)),t("span",null,v(o.task.id),1)]),t("div",ne,[e[2]||(e[2]=t("label",null,"任务名称：",-1)),t("span",null,v(o.task.title),1)]),t("div",oe,[e[3]||(e[3]=t("label",null,"任务描述：",-1)),t("span",null,v(o.task.description),1)]),t("div",ie,[e[4]||(e[4]=t("label",null,"Client Agent ID：",-1)),t("span",null,v(o.task.clientAgentId),1)]),t("div",re,[e[5]||(e[5]=t("label",null,"Server Agent ID：",-1)),t("span",null,v(o.task.serverAgentId),1)]),t("div",ue,[e[6]||(e[6]=t("label",null,"状态：",-1)),C(" "+v(o.task.status),1)]),t("div",de,[e[7]||(e[7]=t("label",null,"执行结果：",-1)),t("span",null,v(o.task.result),1)]),t("div",ce,[e[8]||(e[8]=t("label",null,"创建时间：",-1)),t("span",null,v(l.formatDate(o.task.ctime)),1)])])):z("",!0)]),_:1},8,["modelValue"])}const pe=B(le,[["render",me],["__scopeId","data-v-64f8d75f"],["__file","/Users/zhangzhiyong/IdeaProjects/open/mone/jcommon/hive-manager/src/main/resources/static/src/components/TaskDetailDrawer.vue"]]),_e=h({__name:"CreateTaskDialog",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","submit"],setup(n,{expose:e,emit:o}){e();const l=q(),k=n,b=o,d=y(!1),i=y({taskUuid:"",clientAgentId:null,serverAgentId:null,skillId:null,title:"",description:"",status:"pending"});M(()=>{const c=Number(l.query.serverAgentId);c&&(i.value.serverAgentId=c,i.value.clientAgentId=c)}),x(()=>k.modelValue,c=>{d.value=c}),x(()=>d.value,c=>{b("update:modelValue",c),c||_()});const _=()=>{i.value={taskUuid:"",clientAgentId:null,serverAgentId:null,skillId:null,title:"",description:"",status:""}},f={route:l,props:k,emit:b,dialogVisible:d,taskForm:i,resetForm:_,handleCancel:()=>{d.value=!1},handleSubmit:()=>{b("submit",i.value)}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),ge={class:"dialog-footer"};function ve(n,e,o,l,k,b){const d=F("el-input"),i=F("el-form-item"),_=F("el-form"),m=F("el-button"),V=F("el-dialog");return A(),I(V,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[2]||(e[2]=f=>l.dialogVisible=f),title:"创建任务",width:"500px"},{footer:u(()=>[t("span",ge,[r(m,{onClick:l.handleCancel},{default:u(()=>e[3]||(e[3]=[C("取消")])),_:1}),r(m,{type:"primary",onClick:l.handleSubmit},{default:u(()=>e[4]||(e[4]=[C("确定")])),_:1})])]),default:u(()=>[r(_,{model:l.taskForm,"label-width":"100px"},{default:u(()=>[r(i,{label:"任务名称"},{default:u(()=>[r(d,{modelValue:l.taskForm.title,"onUpdate:modelValue":e[0]||(e[0]=f=>l.taskForm.title=f),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),r(i,{label:"任务描述"},{default:u(()=>[r(d,{modelValue:l.taskForm.description,"onUpdate:modelValue":e[1]||(e[1]=f=>l.taskForm.description=f),type:"textarea",placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}const fe=B(_e,[["render",ve],["__file","/Users/zhangzhiyong/IdeaProjects/open/mone/jcommon/hive-manager/src/main/resources/static/src/components/CreateTaskDialog.vue"]]),Fe=h({__name:"TaskList",setup(n,{expose:e}){e();const o=y([]),l=y(!1),k=y(!1),b=y(null),d=y(!1),i=y(!1),_=q(),m=y({taskUuid:"",clientAgentId:null,serverAgentId:null,skillId:null,title:"",description:"",status:""}),V=y([]),{currentTheme:f}=J(),c=async()=>{l.value=!0;try{const a={};_.query.serverAgentId&&(a.serverAgentId=Number(_.query.serverAgentId));const g=await Y(a);g.data.code===200?o.value=g.data.data||[]:p.error(g.data.message)}catch{p.error("获取任务列表失败")}finally{l.value=!1}},s=async a=>{try{const g=await Z(a.taskUuid);g.data.code===200?(b.value=g.data.data||null,k.value=!0):p.error(g.data.message)}catch{p.error("获取任务详情失败")}},w=()=>{d.value=!0},N=async a=>{try{const g=await ee(a);g.data.code===200?(p.success("创建成功"),d.value=!1,c()):p.error(g.data.message)}catch{p.error("创建任务失败")}},P=async a=>{try{const g=await $({id:a.taskUuid,metadata:{input:a.description,serverAgentId:a.serverAgentId}});g.data.code===200?(p.success("任务执行成功"),c()):p.error(g.data.message)}catch{p.error("执行任务失败")}},O=a=>{m.value={...a},i.value=!0},K=async()=>{try{const a=await te(m.value);a.data.code===200?(p.success("任务更新成功"),i.value=!1,c()):p.error(a.data.message)}catch{p.error("更新任务失败")}},G=a=>new Date(a).toLocaleString(),R=a=>({running:"primary",completed:"success",failed:"danger",pending:"warning"})[a]||"info",T=async()=>{try{const a=await X();a.data.code===200?V.value=a.data.data||[]:p.error(a.data.message)}catch{p.error("获取Agent列表失败")}};M(()=>{c(),T()});const S={taskList:o,loading:l,drawerVisible:k,selectedTask:b,dialogVisible:d,editDialogVisible:i,route:_,editForm:m,agentList:V,currentTheme:f,fetchTasks:c,handleShowDetail:s,handleCreate:w,handleSubmit:N,handleExecute:P,handleEdit:O,handleEditSubmit:K,formatDate:G,getStatusType:R,fetchAgentList:T,TaskDetailDrawer:pe,CreateTaskDialog:fe};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),ke={class:"task-list-container"},be={class:"table-container"},Ae={class:"task-table"},ye={key:0,class:"loading-container"},Ve={key:"empty",class:"empty-state"},De=["onClick"],Ce={class:"task-info"},Ee={class:"task-avatar"},we={class:"task-logo-placeholder"},Ie={class:"task-details"},he={class:"task-status"},Be={class:"activity"},Te={class:"task-actions"},Se=["onClick","disabled"],xe=["onClick"],Ue={class:"dialog-footer"};function Le(n,e,o,l,k,b){const d=F("el-option"),i=F("el-select"),_=F("el-form-item"),m=F("el-input"),V=F("el-form"),f=F("el-button"),c=F("el-dialog");return A(),D("div",ke,[e[14]||(e[14]=t("div",{class:"cyber-grid"},null,-1)),e[15]||(e[15]=t("div",{class:"circuit-point point-1"},null,-1)),e[16]||(e[16]=t("div",{class:"circuit-point point-2"},null,-1)),t("div",{class:"dashboard-header"},[t("button",{class:"create-btn",onClick:l.handleCreate},"+ TASK")]),t("div",be,[t("div",Ae,[l.loading?(A(),D("div",ye,e[6]||(e[6]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)]))):(A(),I(Q,{key:1,name:"list",tag:"div"},{default:u(()=>[l.taskList.length===0?(A(),D("div",Ve,[t("div",{class:"empty-content"},[e[7]||(e[7]=t("span",{class:"empty-text"},"暂无任务数据",-1)),e[8]||(e[8]=t("br",null,null,-1)),t("button",{class:"create-btn",onClick:l.handleCreate},"创建TASK")])])):z("",!0),(A(!0),D(U,null,L(l.taskList,s=>(A(),D("div",{key:s.id,class:"task-card",onClick:w=>l.handleShowDetail(s)},[t("div",Ce,[t("div",Ee,[t("div",we,v(s.title.charAt(0).toUpperCase()),1)]),t("div",Ie,[t("h4",null,v(s.title),1),t("p",null,v(s.description),1)])]),t("div",he,[t("span",{class:W(["badge",s.status.toLowerCase()])},v(s.status),3)]),t("div",Be,[e[9]||(e[9]=t("span",null,"创建时间：",-1)),t("time",null,v(l.formatDate(s.ctime)),1),e[10]||(e[10]=t("br",null,null,-1)),e[11]||(e[11]=t("span",null,"更新时间：",-1)),t("time",null,v(l.formatDate(s.utime)),1)]),t("div",Te,[t("button",{class:"execute-btn",onClick:j(w=>l.handleExecute(s),["stop"]),disabled:s.status==="running"}," 执行 ",8,Se),t("button",{class:"edit-btn",onClick:j(w=>l.handleEdit(s),["stop"])}," 修改 ",8,xe)])],8,De))),128))]),_:1}))])]),r(l.TaskDetailDrawer,{modelValue:l.drawerVisible,"onUpdate:modelValue":e[0]||(e[0]=s=>l.drawerVisible=s),task:l.selectedTask},null,8,["modelValue","task"]),r(l.CreateTaskDialog,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[1]||(e[1]=s=>l.dialogVisible=s),onSubmit:l.handleSubmit},null,8,["modelValue"]),r(c,{modelValue:l.editDialogVisible,"onUpdate:modelValue":e[5]||(e[5]=s=>l.editDialogVisible=s),title:"修改任务",width:"400px"},{footer:u(()=>[t("span",Ue,[r(f,{onClick:e[4]||(e[4]=s=>l.editDialogVisible=!1)},{default:u(()=>e[12]||(e[12]=[C("取消")])),_:1}),r(f,{type:"primary",onClick:l.handleEditSubmit},{default:u(()=>e[13]||(e[13]=[C("提交")])),_:1})])]),default:u(()=>[r(V,{model:l.editForm,"label-width":"70px"},{default:u(()=>[r(_,{label:"Agent"},{default:u(()=>[r(i,{modelValue:l.editForm.serverAgentId,"onUpdate:modelValue":e[2]||(e[2]=s=>l.editForm.serverAgentId=s),placeholder:"请选择"},{default:u(()=>[(A(!0),D(U,null,L(l.agentList,s=>(A(),I(d,{key:s.agent.id,label:s.agent.name,value:s.agent.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(_,{label:"任务描述"},{default:u(()=>[r(m,{modelValue:l.editForm.description,"onUpdate:modelValue":e[3]||(e[3]=s=>l.editForm.description=s),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}const Me=B(Fe,[["render",Le],["__scopeId","data-v-ca672679"],["__file","/Users/zhangzhiyong/IdeaProjects/open/mone/jcommon/hive-manager/src/main/resources/static/src/views/TaskList.vue"]]);export{Me as default};
