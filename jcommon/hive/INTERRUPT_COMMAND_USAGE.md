# ä¸­æ–­å‘½ä»¤ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

RoleService çš„ `receiveMsg` æ–¹æ³•ç°åœ¨æ”¯æŒé€šè¿‡ç‰¹å®šå‘½ä»¤æ¥ä¸­æ–­ Agent çš„æ‰§è¡Œï¼Œå¹¶å®ç°æ™ºèƒ½çš„ä¸­æ–­çŠ¶æ€ç®¡ç†ã€‚

## æ”¯æŒçš„ä¸­æ–­å‘½ä»¤

### è‹±æ–‡å‘½ä»¤
- `/exit` - é€€å‡º/ä¸­æ–­
- `/stop` - åœæ­¢
- `/interrupt` - ä¸­æ–­
- `/cancel` - å–æ¶ˆ

### ä¸­æ–‡å‘½ä»¤
- åŒ…å« "åœæ­¢" çš„æ¶ˆæ¯
- åŒ…å« "ä¸­æ–­" çš„æ¶ˆæ¯  
- åŒ…å« "å–æ¶ˆ" çš„æ¶ˆæ¯

## å·¥ä½œæµç¨‹

### 1. å‘é€ä¸­æ–­å‘½ä»¤

å½“ç”¨æˆ·å‘é€ä»»ä½•ä¸­æ–­å‘½ä»¤æ—¶ï¼š

```java
// ç”¨æˆ·å‘é€æ¶ˆæ¯
Message message = Message.builder()
    .content("/exit")  // æˆ–å…¶ä»–ä¸­æ–­å‘½ä»¤
    .sentFrom("user123")
    .build();

// RoleService å¤„ç†
Flux<String> response = roleService.receiveMsg(message);
```

**ç³»ç»Ÿå“åº”ï¼š**
```
ğŸ›‘ Agent user123 å·²è¢«å¼ºåˆ¶ä¸­æ–­
ğŸ’¡ å‘é€ä»»ä½•æ–°å‘½ä»¤å°†è‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€å¹¶ç»§ç»­æ‰§è¡Œ
```

### 2. é‡å¤å‘é€ä¸­æ–­å‘½ä»¤

å¦‚æœ Agent å·²ç»å¤„äºä¸­æ–­çŠ¶æ€ï¼Œå†æ¬¡å‘é€ä¸­æ–­å‘½ä»¤ï¼š

**ç³»ç»Ÿå“åº”ï¼š**
```
âš ï¸ Agent user123 å·²ç»å¤„äºä¸­æ–­çŠ¶æ€
ğŸ’¡ å‘é€ä»»ä½•éä¸­æ–­å‘½ä»¤å°†è‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€å¹¶ç»§ç»­æ‰§è¡Œ
```

### 3. è‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€

å½“ Agent å¤„äºä¸­æ–­çŠ¶æ€æ—¶ï¼Œæ”¶åˆ°éä¸­æ–­å‘½ä»¤ä¼šè‡ªåŠ¨é‡ç½®ï¼š

```java
// Agent å½“å‰å¤„äºä¸­æ–­çŠ¶æ€
// ç”¨æˆ·å‘é€æ­£å¸¸å‘½ä»¤
Message normalMessage = Message.builder()
    .content("å¸®æˆ‘å†™ä¸€ä¸ªHello Worldç¨‹åº")
    .sentFrom("user123")
    .build();

Flux<String> response = roleService.receiveMsg(normalMessage);
```

**ç³»ç»Ÿå“åº”ï¼š**
```
ğŸ”„ æ£€æµ‹åˆ°æ–°å‘½ä»¤ï¼Œå·²è‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œ...
[ç„¶åæ­£å¸¸å¤„ç†ç”¨æˆ·è¯·æ±‚]
```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### ä¸­æ–­å‘½ä»¤æ£€æµ‹é€»è¾‘

```java
private boolean isInterruptCommand(String content) {
    if (content == null) {
        return false;
    }
    String trimmed = content.trim().toLowerCase();
    return trimmed.equals("/exit") || 
           trimmed.equals("/stop") || 
           trimmed.equals("/interrupt") ||
           trimmed.equals("/cancel") ||
           trimmed.contains("åœæ­¢") ||
           trimmed.contains("ä¸­æ–­") ||
           trimmed.contains("å–æ¶ˆ");
}
```

### ä¸­æ–­å¤„ç†æµç¨‹

1. **æ£€æŸ¥ä¸­æ–­å‘½ä»¤** - ä¼˜å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºä¸­æ–­å‘½ä»¤
2. **å¤„ç†ä¸­æ–­çŠ¶æ€** - æ ¹æ®å½“å‰çŠ¶æ€ç»™å‡ºç›¸åº”æç¤º
3. **è‡ªåŠ¨é‡ç½®é€»è¾‘** - éä¸­æ–­å‘½ä»¤è‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€
4. **æ­£å¸¸å¤„ç†** - ç»§ç»­åç»­çš„æ¶ˆæ¯å¤„ç†æµç¨‹

## ä½¿ç”¨åœºæ™¯

### 1. ç”¨æˆ·ä¸»åŠ¨ä¸­æ–­

```bash
ç”¨æˆ·: "å¸®æˆ‘åˆ†æè¿™ä¸ªå¤§æ–‡ä»¶"
ç³»ç»Ÿ: [å¼€å§‹åˆ†æ...]
ç”¨æˆ·: "/exit"
ç³»ç»Ÿ: "ğŸ›‘ Agent user123 å·²è¢«å¼ºåˆ¶ä¸­æ–­"
```

### 2. ä¸­æ–­åç»§ç»­

```bash
ç”¨æˆ·: "/exit"
ç³»ç»Ÿ: "ğŸ›‘ Agent user123 å·²è¢«å¼ºåˆ¶ä¸­æ–­"
ç”¨æˆ·: "å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°"
ç³»ç»Ÿ: "ğŸ”„ æ£€æµ‹åˆ°æ–°å‘½ä»¤ï¼Œå·²è‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œ..."
ç³»ç»Ÿ: [å¼€å§‹å¤„ç†æ–°è¯·æ±‚]
```

### 3. ä¸­æ–‡å‘½ä»¤æ”¯æŒ

```bash
ç”¨æˆ·: "åœæ­¢å½“å‰ä»»åŠ¡"
ç³»ç»Ÿ: "ğŸ›‘ Agent user123 å·²è¢«å¼ºåˆ¶ä¸­æ–­"
ç”¨æˆ·: "ä¸­æ–­æ‰§è¡Œ"
ç³»ç»Ÿ: "âš ï¸ Agent user123 å·²ç»å¤„äºä¸­æ–­çŠ¶æ€"
```

## ä¸åŸæœ‰ä¸­æ–­åŠŸèƒ½çš„å…³ç³»

### å‘½ä»¤çº§ä¸­æ–­ vs APIçº§ä¸­æ–­

1. **å‘½ä»¤çº§ä¸­æ–­ï¼ˆæ–°åŠŸèƒ½ï¼‰**
   - é€šè¿‡ç”¨æˆ·æ¶ˆæ¯è§¦å‘
   - ç”¨æˆ·å‹å¥½çš„äº¤äº’æ–¹å¼
   - è‡ªåŠ¨çŠ¶æ€ç®¡ç†

2. **APIçº§ä¸­æ–­ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰**
   - é€šè¿‡ç¼–ç¨‹æ¥å£è°ƒç”¨
   - ç³»ç»Ÿçº§æ§åˆ¶
   - æ‰‹åŠ¨çŠ¶æ€ç®¡ç†

### ç»„åˆä½¿ç”¨

```java
// API ä¸­æ–­
roleService.interruptAgent(message);

// ç”¨æˆ·ç¨åå‘é€å‘½ä»¤ä¼šè‡ªåŠ¨é‡ç½®
Message newMessage = Message.builder()
    .content("æ–°çš„ä»»åŠ¡")
    .sentFrom("user123")
    .build();
    
roleService.receiveMsg(newMessage); // è‡ªåŠ¨é‡ç½®å¹¶å¤„ç†
```

## æ—¥å¿—è®°å½•

ç³»ç»Ÿä¼šè®°å½•æ‰€æœ‰ä¸­æ–­ç›¸å…³çš„æ“ä½œï¼š

```
2025-09-22 14:30:15 INFO  Agent user123 æ”¶åˆ°ä¸­æ–­å‘½ä»¤ï¼Œå·²è¢«ä¸­æ–­
2025-09-22 14:31:20 INFO  Agent user123 æ”¶åˆ°æ–°çš„éä¸­æ–­å‘½ä»¤ï¼Œè‡ªåŠ¨é‡ç½®ä¸­æ–­çŠ¶æ€
```

## æœ€ä½³å®è·µ

### 1. ç”¨æˆ·ä½“éªŒ
- æä¾›æ¸…æ™°çš„çŠ¶æ€åé¦ˆ
- æ”¯æŒå¤šè¯­è¨€å‘½ä»¤
- è‡ªåŠ¨åŒ–çŠ¶æ€ç®¡ç†

### 2. ç³»ç»Ÿç¨³å®šæ€§
- ä¼˜é›…çš„ä¸­æ–­å¤„ç†
- é˜²æ­¢çŠ¶æ€æ··ä¹±
- å®Œæ•´çš„æ—¥å¿—è®°å½•

### 3. å¼€å‘å»ºè®®
- ç›‘æ§ä¸­æ–­é¢‘ç‡
- åˆ†æç”¨æˆ·ä¸­æ–­æ¨¡å¼
- ä¼˜åŒ–å“åº”é€Ÿåº¦

è¿™ä¸ªåŠŸèƒ½è®©ç”¨æˆ·å¯ä»¥æ›´è‡ªç„¶åœ°æ§åˆ¶ Agent çš„æ‰§è¡Œï¼Œæä¾›äº†æ›´å¥½çš„äº¤äº’ä½“éªŒã€‚
